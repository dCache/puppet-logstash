######################################################################
##
## DO NOT EDIT
## generated by puppet module :  <%= @name %>
## node                       :  <%= @fqdn %>
##
######################################################################

input {

  file {
    path => "/var/log/dcache/*.log"
    exclude => "*.gz"
    tags => [<% @logstash_configuration['Tags'].each do |tag| %> "<%= tag %>", <% end %> "logs"]
    sincedb_path => "/var/tmp/sincedb-dcache"
    start_position => beginning
    ignore_older => 0
    codec => multiline {
      pattern => "^%{MONTHDAY} %{MONTH} %{YEAR}"
      negate => true
      what => "previous"
    }
  }
}

filter{
  grok {
    match => [ "message", "%{MONTHDAY:day} %{MONTH:mon} %{YEAR:year} %{TIME:time} \(%{DATA:cell}\) \[(%{DATA:ndc})?\] %{GREEDYDATA:log_message}" ]
    add_field => {"logtime" => "%{day} %{mon} %{year} %{time}"}
    remove_field => [ "message" ]
  }

  date {
    match => [ "logtime", "dd MMM YYYY HH:mm:ss" ]
    timezone => "CET"
    remove_field => [ "logtime", "day", "mon", "year", "time" ]
  }
}

output {

  kafka {
        codec => json
        client_id => "<%= @hostname %>"
        topic_id => "<%= @logstash_configuration['KafkaTopic'] %>"
        bootstrap_servers => "<%= @logstash_configuration['KafkaBrokers'] %>"
        id => "dcache-<%= @logstash_configuration['KafkaTopic'] %>"
      }

  }
